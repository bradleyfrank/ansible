---

- name: "Include per-OS variables"
  ansible.builtin.include_vars:
    file: "{{ ansible_facts['system'] }}.yml"
  tags: [desktop, fonts, icons]

- name: "Install desktop utilities"
  ansible.builtin.package:
    name: "{{ desktop_packages }}"
    state: present
  become: "{{ true if ansible_facts['system'] == 'Linux' else false }}"
  tags: [desktop, fonts, icons, never]

- name: "Reset macOS dock"
  community.general.osx_defaults:
    domain: com.apple.dock
    key: "persistent-apps"
    type: "array"
    value: []
  notify: Restart macOS dock
  when: ansible_facts['system'] == "Darwin"
  tags: [never]

- name: "Reset Gnome dock"
  community.general.dconf:
    key: "/org/gnome/shell/favorites"
    value: "['org.gnome.Nautilus.desktop']"
  when: "'gnome' in system_current_desktop"
  tags: [never]

- name: "Include font tasks"
  ansible.builtin.include_tasks:
    file: "fonts/main.yml"
  tags: [desktop, fonts]

- name: "Include Logitech tasks"
  ansible.builtin.include_tasks:
    file: "logi.yml"
  when: (ansible_facts['system'] == "Darwin") and desktop_logi_app_install
  tags: [desktop, kvm]

- name: "Include icon tasks"
  ansible.builtin.include_tasks:
    file: "icons.yml"
  loop: "{{ desktop_apps_paths }}"
  loop_control:
    label: "{{ path }}"
    loop_var: path
  when: ansible_facts['system'] == "Darwin"
  tags: [desktop, icons]
