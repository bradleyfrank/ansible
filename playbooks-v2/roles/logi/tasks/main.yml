---

- name: Check if Logi Options+ is installed
  ansible.builtin.stat:
    path: "/Applications/logioptionsplus.app"
  register: logioptionsplus_app
  when: ansible_facts['system'] == "Darwin"
  tags: [logi]

- name: Find Logi installer
  ansible.builtin.find:
    paths: "{{ logi_homebrew_prefix }}/Caskroom/logi-options-plus"
    follow: true
    recurse: true
    patterns: "logioptionsplus_installer.app"
    file_type: directory
  register: logioptionsplus_installer
  when: (ansible_facts['system'] == "Darwin") and (not logioptionsplus_app['stat']['exists'])
  tags: [logi]

- name: Copy Logi installer
  ansible.builtin.copy:
    src: "{{ logioptionsplus_installer['files'][0]['path'] }}"
    dest: "{{ ansible_facts['user_dir'] }}/Downloads"
    mode: 0755
  when: (ansible_facts['system'] == "Darwin") and (not logioptionsplus_app['stat']['exists'])
  tags: [logi]
