---

- name: Stop packagekit
  ansible.builtin.systemd:
    name: "packagekit"
    state: "stopped"
    enabled: false
  become: true
  notify: Start packagekit
  tags: always

- name: Include distro-specific package managers
  ansible.builtin.include_tasks:
    file: "managers/{{ ansible['pkg_mgr'].yml }}"
    apply:
      tags: [packages]
  tags: always

- name: Gather package facts
  ansible.builtin.package_facts:
    manager: "auto"
  tags: always

- name: Include Flakpak packages
  ansible.builtin.include_tasks:
    file: "managers/flatpak.yml"
    apply:
      tags: [packages, flatpak]
  tags: always

- name: Include Homebrew packages
  ansible.builtin.include_tasks:
    file: "managers/homebrew.yml"
    apply:
      tags: [packages, homebrew]
  when: install_pkgs_homebrow
  tags: always

