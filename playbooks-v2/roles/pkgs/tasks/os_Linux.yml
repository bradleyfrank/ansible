---

- name: Stop packagekit
  ansible.builtin.systemd:
    name: "packagekit"
    state: "stopped"
    enabled: false
  become: true
  notify: Start packagekit
  tags: always

- name: Include distro-specific package managers
  ansible.builtin.include_tasks:
    file: "managers/{{ ansible['pkg_mgr'].yml }}"
  tags: always

- name: Gather package facts
  ansible.builtin.package_facts:
    manager: "auto"
  tags: always

- name: Include Flakpak packages
  ansible.builtin.include_tasks:
    file: "managers/flatpak.yml"
  tags: always

- name: Include Homebrew packages
  ansible.builtin.include_tasks:
    file: "managers/homebrew.yml"
  when: (pkgs_homebrew_taps | length > 0) or (pkgs_homebrew_formulas | length > 0)
  tags: always
