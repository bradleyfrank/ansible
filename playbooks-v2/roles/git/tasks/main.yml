---

# TODO: support for GPG signing key

- name: Read public SSH key for signing key
  ansible.builtin.set_fact:
    signing_key: "{{ lookup('ansible.builtin.file', git_signing_key_file) | split }}"
  when: git_signing_key_type == "ssh"
  tags: [git, dotfiles]

- name: Install gitconfig
  ansible.builtin.template:
    src: gitconfig.j2
    dest: "{{ git_config_path }}"
    mode: "0755"
  tags: [git, config]

- name: Enable fsmonitor daemon
  community.general.ini_file:
    path: "{{ git_config_path }}"
    section: "core"
    option: "fsmonitor"
    value: "true"
  when: git_enable_fsmonitor

- name: Create allowed signers file
  ansible.builtin.template:
    src: allowed_signers.j2
    dest: "{{ git_allowed_signers_file }}"
    mode: "0644"
  tags: [git, signing]
