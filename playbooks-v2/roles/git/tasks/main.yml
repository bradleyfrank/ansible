---

- name: Include local config tasks
  ansible.builtin.include_tasks:
    file: "config.yml"
  tags: always

- name: Include GitHub config tasks
  ansible.builtin.include_tasks:
    file: "github.yml"
  when: "'github' in git_providers"
  tags: always

- name: Include repo tasks
  vars:
    git_repo_url: "{{ item['url'] }}"
    git_repo_name: "{{ git_repo_url | split('.') | first }}"
    git_repo_branch: "{{ item['branch'] | default('main') }}"
    git_repo_dir_prefix: "{{ git_clone_repos_path }}/{{ git_repo_name }}"
    git_repo_dir_suffix: "{{ git_repo_branch if git_clone_repos_as_worktrees else '' }}/"
    git_repo_update: "{{ item['update'] }}"
  ansible.builtin.include_tasks:
    file: "repos.yml"
  loop: "{{ git_clone_repos }}"
  loop_control:
    label: "{{ git_repo_name }}"
  tags: always
