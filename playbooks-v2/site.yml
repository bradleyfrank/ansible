---

- name: Bootstrap Ansible
  hosts: localhost

- name: Import inventory playbook
  ansible.builtin.import_playbook: inventory.yml

- name: Import Ansible galaxy playbook
  ansible.builtin.import_playbook: collections.yml

- name: Set desktop environment
  ansible.builtin.set_fact:
    XDG_CURRENT_DESKTOP: "{{ (ansible_env['XDG_CURRENT_DESKTOP'] | lower)"
  when: ansible['system'] == "Linux"
  tags: always

- name: Update all packages
  ansible.builtin.dnf:
    name: "*"
    state: latest
    update_cache: true
    install_weak_deps: true
  become: true
  when: ansible['pkg_mgr'] == "dnf"
  tags: [update]

- name: Update system
  ansible.builtin.apt:
    name: "*"
    state: latest
    autoclean: true
    autoremove: true
    update_cache: true
    cache_valid_time: 3600
    install_recommends: true
  become: true
  when: ansible['pkg_mgr'] == "apt"
  tags: [update]

