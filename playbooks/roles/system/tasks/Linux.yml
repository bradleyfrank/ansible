---

# TODO: Support for LMDE/Debian
- name: Add DNS fallback
  ansible.builtin.lineinfile:
    path: "/etc/systemd/resolved.conf"
    regexp: "^#?FallbackDNS="
    line: "FallbackDNS={{ system_linux_dns_fallback | join(' ') }}"
  when: system_linux_add_dns_fallback
  become: true
  tags: [system, linux_settings, dns]

- name: Apply Gnome settings
  community.general.dconf:
    key: "{{ item['key'] }}"
    value: "{{ item['value'] }}"
  loop: "{{ system_linux_gnome_settings | dict2items }}"
  loop_control:
    lable: "{{ name }}"
  tags: [system, linux_settings, dconf]
  when: system_linux_gnome_desktop

- name: Apply Dracut settings
  ansible.builtin.lineinfile:
    create: "{{ item['create'] | default(true) }}"
    mode: "0644"
    path: "{{ item['path'] }}"
    line: "{{ item['line'] | default(omit) }}"
    regexp: "{{ item['regexp'] | default(omit) }}"
    state: "{{ item['state'] | default('present') }}"
    search_string: "{{ item['search_string'] | default(omit) }}"
    insertafter: "{{ item['insertafter'] | default(omit) }}"
    insertbefore: "{{ item['insertbefore'] | default(omit) }}"
    backrefs: "{{ item['backrefs'] | default(omit) }}"
  loop: "{{ system_linux_dracut_settings }}"
  loop_control:
    label: "{{ item['desc'] }}"
  become: true
  notify: Regenerate Dracut
  tags: [system, linux_settings, dracut]
