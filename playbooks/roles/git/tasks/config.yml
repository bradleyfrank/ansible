---

- name: Read public SSH key for signing key
  ansible.builtin.set_fact:
    git_signing_key: "{{ lookup('ansible.builtin.file', git_signing_key_file) | split }}"
  when: git_signing_key_type == "ssh"
  tags: [git, dotfiles]

- name: Create gitconfig
  vars:
    key_contents: "{{ lookup('ansible.builtin.file', git_signing_key_file) | split(' ') }}"
  ansible.builtin.template:
    src: "{{ lookup('ansible.builtin.first_found', git_template_gitconfig) }}"
    dest: "{{ git_config_path }}"
    mode: "0755"
  tags: [git, config, dotfiles]

- name: Create allowed signers file
  ansible.builtin.template:
    src: "{{ lookup('ansible.builtin.first_found', git_template_allowed_signers) }}"
    dest: "{{ git_signing_allowed_signers }}"
    mode: "0644"
  tags: [git, signing, dotfiles]
