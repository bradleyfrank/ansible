---

- name: Apply dotfiles to localhost
  hosts: localhost
  tasks:
    - name: Include common variables
      ansible.builtin.include_vars: common.yml
      tags: always
    - name: Query repos
      ansible.builtin.uri:
        url: https://api.github.com/search/repositories?q=user:bradleyfrank+archived:false
        headers:
          Authorization: "token {{ github_token }}"
      register: repos
    - name: Clone repos
      ansible.builtin.git:
        repo: "{{ item['ssh_url'] }}"
        dest: "{{ git_reference_repos_dest }}/{{ item['name'] }}"
        accept_hostkey: true
        key_file:
      loop: "{{ repos['json']['items'] }}"
