---

- name: Install and configure dotfiles on localhost
  hosts: localhost

  tasks:
    - name: Include common variables
      ansible.builtin.include_vars: common.yml
      tags: always

    - name: Include system variables
      ansible.builtin.include_vars: "system_{{ ansible_system }}.yml"
      tags: always

    - name: Include Linux distribution variables
      ansible.builtin.include_vars: "os_{{ distro_vars[ansible_distribution] }}.yml"
      when: ansible_system == 'Linux'
      tags: always

    - name: Find backups older than 4 weeks
      ansible.builtin.find:
        paths: "{{ backups_dir }}"
        patterns: "zshrc.*"
      register: old_backups
      tags: ['always', 'backups']

    - name: Show
      vars:
        files: "{{ old_backups['files'] | sort(attribute='ctime') }}"
      ansible.builtin.debug:
        msg: "{{ files[2:] }}"
