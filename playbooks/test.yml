---

- name: Bootstrap localhost system
  hosts: localhost
  vars:
    gh_packages:
      - name: hyper
        repo: hyper
        user: vercel
        system_type: [desktop]
      - name: stern
        repo: stern
        user: stern
        system_type: [desktop, server]
      - name: starship
        repo: starship
        user: starship
        system_type: [desktop, server]
  tasks:
  - name: Get latest version
    community.general.github_release:
      user: "{{ item.user }}"
      repo: "{{ item.repo }}"
      action: latest_release
      token: "{{ github['token'] }}"
    register: latest_versions
    loop: "{{ gh_packages }}"
  - name: Setting facts
    vars:
      name: "{{ item['item']['name'] }}"
      version: "{{ item['tag'] }}"
    set_fact:
      github_pkgs: "{{ github_pkgs | default({}) | combine({name: version}) }}"
      cacheable: yes
    loop: "{{ latest_versions['results'] }}"