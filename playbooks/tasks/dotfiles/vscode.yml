---

- name: Get list of installed VSCode extensions
  ansible.builtin.command: code --list-extensions
  changed_when: false
  failed_when: code_list_extensions['rc'] not in [0,1]
  register: code_list_extensions
  tags: vscode

- name: Install VSCode extensions not already installed
  vars:
    installed_extensions: "{{ code_list_extensions['stdout_lines'] }}"
  ansible.builtin.command: "{{ vscode['bin'] }} --install-extension {{ item }}"
  register: code_install_extension
  changed_when: "'successfully installed' in code_install_extension.stdout"
  loop: "{{ vscode_extensions | difference(installed_extensions) }}"
  loop_control:
    label: "{{ item }}"
  tags: vscode

- name: Install VSCode configs
  ansible.builtin.copy:
    src: apps/vscode/
    dest: "{{ vscode['config'] }}/"
    mode: 0755
    backup: true
  register: _backup_vscode_settings_json
  tags: ['vscode', 'core']
