---

- name: Check if vscode is installed
  ansible.builtin.stat:
    path: "{{ vscode['bin'] }}"
  register: vscode_bin

- name: Install VSCode extensions
  block:
    - name: Get list of installed vscode extensions
      ansible.builtin.command: code --list-extensions
      changed_when: false
      failed_when: code_list_extensions['rc'] not in [0,1]
      register: code_list_extensions
    - name: Install extensions not already installed
      vars:
        installed_extensions: "{{ code_list_extensions['stdout_lines'] }}"
      ansible.builtin.command: "{{ vscode['bin'] }} --install-extension {{ item }}"
      loop: "{{ vscode_extensions | difference(installed_extensions) }}"
      loop_control:
        label: "{{ item }}"
  when: vscode_bin['stat']['exists']
