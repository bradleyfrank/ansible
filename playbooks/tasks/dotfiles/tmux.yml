---

- name: Ensure ~/.config/tmux directory exists
  ansible.builtin.file:
    path: "{{ ansible_user_dir }}/.config/tmux"
    state: directory
    mode: 0755

- name: Install tmux config
  ansible.builtin.template:
    src: tmux.conf.j2
    dest: "{{ ansible_user_dir }}/.config/tmux/{{ item }}.conf"
    mode: 0644
  loop:
    - tmux
    - minimal

- name: Check for battery
  ansible.builtin.stat:
    path: /sys/class/power_supply/BAT0
  register: battery
  when: "'Fedora' in ansible_distribution"

- name: Install tmux script
  vars:
    battery_present: "{{ battery['stat']['exists'] | default(True) }}"
  ansible.builtin.template:
    src: tmux-status.bash.j2
    dest: "{{ ansible_user_dir }}/.local/bin/tmux-status"
    mode: 0755

- name: Symlink main tmuxp profile
  ansible.builtin.file:
    src: "{{ ansible_user_dir }}/.config/tmuxp/{{ 'work' if work_system else 'home' }}.yml"
    dest: "{{ ansible_user_dir }}/.config/tmuxp/main.yml"
    owner: "{{ ansible_user_id }}"
    group: "{{ user_group }}"
    state: link

