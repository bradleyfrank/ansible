---

- name: Include OS-specific packages
  ansible.builtin.include_tasks: "packages/{{ ansible_system }}.yml"

- name: Install VSCode extensions
  ansible.builtin.command: "{{ vscode['bin'] }} --install-extension {{ item }}"
  loop: "{{ vscode_extensions }}"
  tags:
    - packages
    - vscode

- name: Install Python packages
  ansible.builtin.pip:
    name: "{{ python_packages }}"
    extra_args: --user
  tags:
    - packages
    - python

- name: Ensure Docker is running
  ansible.builtin.systemd:
    name: docker
    daemon_reload: true
    enabled: true
    state: started
  become: true
  when: ansible_system == 'Linux'

- name: Pull Docker images
  environment:
    PATH: "{{ ansible_env.PATH }}:{{ ansible_user_dir }}/.local/bin"
  community.docker.docker_image:
    name: "{{ item }}"
    source: pull
  loop: "{{ docker_images }}"
  tags:
    - packages
    - docker
