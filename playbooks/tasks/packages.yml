---

- name: Lookup GitHub package latest release
  environment:
    PYTHONPATH: "{{ ansible_env['PYTHONPATH'] | default('') }}:{{ python_user_site }}"
  community.general.github_release:
    user: "{{ item['value']['user'] }}"
    repo: "{{ item['key'] }}"
    action: latest_release
    token: "{{ github_token }}"
  register: github_package_metadata
  loop: "{{ github_packages | default({}) | dict2items }}"
  tags: [packages, github]

- name: Include OS-specific packages
  ansible.builtin.include_tasks: "packages/{{ distro_vars[ansible_distribution] }}.yml"
  tags: always
