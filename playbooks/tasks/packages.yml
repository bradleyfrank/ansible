---

- name: Lookup GitHub package latest release
  community.general.github_release:
    user: "{{ item['value']['user'] }}"
    repo: "{{ item['key'] }}"
    action: latest_release
    token: "{{ github_token }}"
  register: github_package_metadata
  loop: "{{ github_packages | default({}) | dict2items }}"
  tags: [packages, github]

- name: Include OS-specific packages
  ansible.builtin.include_tasks: "packages/{{ distro_vars[ansible_distribution] }}.yml"
  tags: always

- name: Pull Docker images
  environment:
    PYTHONPATH: "{{ ansible_env['PYTHONPATH'] }}:{{ user_site }}"
  community.docker.docker_image:
    name: "{{ item }}"
    source: pull
  become: true
  loop: "{{ docker_images }}"
  tags: docker
