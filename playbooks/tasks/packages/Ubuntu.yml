---

- name: Install Ubuntu/Pop!_OS packages
  ansible.builtin.apt:
    name: "{{ system_packages + dist_packages }}"
    state: present
    install_recommends: true
    update_cache: true
  become: true
  tags:
    - packages
    - apt

- name: Install snaps
  community.general.snap:
    name: "{{ snap_packages }}"
  become: true
  tags:
    - packages
    - snap

- name: Install GitHub package
  vars:
    repo: "{{ item['invocation']['module_args']['repo'] }}"
    user: "{{ item['invocation']['module_args']['user'] }}"
    prefix: "{{ github_packages[repo]['user']['file_prefix'] }}"
    suffix: "{{ github_packages[repo]['user']['file_suffix'] }}"
    package_download_url: |
      https://github.com/{{ user }}/{{ repo }}/releases/download/
      {{ item['tag'] }}/{{ prefix }}{{ item['tag'] }}{{ suffix }}
  ansible.builtin.apt:
    deb: "{{ package_download_url }}"
  become: true
  loop: "{{ github_package_metadata['results'] | default({}) }}"
  tags:
    - packages
    - github
