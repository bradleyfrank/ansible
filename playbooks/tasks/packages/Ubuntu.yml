---

- name: Install Ubuntu/Pop!_OS packages
  ansible.builtin.apt:
    name: "{{ system_packages + dist_packages }}"
    state: present
    install_recommends: true
    update_cache: true
  become: true
  tags:
    - packages
    - apt

- name: Install snaps
  community.general.snap:
    name: "{{ snap_packages }}"
  become: true
  tags:
    - packages
    - snap

- name: Install GitHub packages
  vars:
    user: "{{ item['invocation']['module_args']['user'] }}"
    repo: "{{ item['invocation']['module_args']['repo'] }}"
    version: "{{ item['tag'] }}"
    github_url: "https://github.com/{{ user }}/{{ repo }}/releases/download"
    filename: "{{ file_prefix }}{{ version }}{{ file_suffix }}"
  ansible.builtin.apt:
    deb: "{{ github_url }}/{{ version }}/{{ filename }}"
  become: true
  loop: "{{ github_packages_metadata['results'] | default({}) }}"
  tags:
    - packages
    - github
