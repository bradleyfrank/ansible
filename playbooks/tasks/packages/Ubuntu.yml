---

- name: Install Ubuntu/Pop!_OS packages
  ansible.builtin.apt:
    name: "{{ system_packages + dist_packages }}"
    state: present
    install_recommends: true
    update_cache: true
  become: true
  tags:
    - packages
    - apt

- name: Install snaps
  community.general.snap:
    name: "{{ snap_packages }}"
  become: true
  tags:
    - packages
    - snap

- name: Install GitHub package
  vars:
    package_download_url: |
      https://github.com/{{ github_packages[repo]['user'] }}/
      {{ item['invocation']['module_args']['repo'] }}/
      releases/download/{{ item['tag'] }}/
      {{ github_packages[repo]['user']['file_prefix'] }}
      {{ item['tag'] }}
      {{ github_packages[repo]['user']['file_suffix'] }}
  ansible.builtin.apt:
    deb: "{{ package_download_url }}"
  become: true
  loop: "{{ github_package_metadata | default({}) }}"
  tags:
    - packages
    - github
