---

- name: Stop packagekit
  ansible.builtin.systemd:
    name: packagekit
    state: stopped
  become: true
  tags: [packages, apt, dnf]

- name: Include os-family-specific package installations
  ansible.builtin.include_tasks: "tasks/packages/family_{{ ansible_os_family }}.yml"
  tags: always

- name: Install flatpak remotes
  community.general.flatpak_remote:
    name: "{{ item['name'] }}"
    state: present
    flatpakrepo_url: "{{ item['url'] }}"
    method: user
  loop: "{{ flatpaks['remotes'] }}"
  loop_control:
    label: "{{ item['name'] }}"
  when: "'desktop' in system_type"
  tags: [packages, flatpak]

- name: Install flatpak packages
  community.general.flatpak:
    name: "{{ item['name'] }}"
    state: present
    method: user
    remote: "{{ item['remote'] | default('flathub') }}"
  loop: "{{ flatpaks['packages'] }}"
  when: "'desktop' in system_type"
  tags: [packages, flatpak]

- name: Install packages from Github
  vars:
    name: "{{ item }}"
  ansible.builtin.include_tasks:
    file: helpers/github_release.yml
    apply:
      tags: "{{ item }}"
  loop: [sysz]
  tags: [packages, github]
