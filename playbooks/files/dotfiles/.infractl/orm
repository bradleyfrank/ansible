export ORM_GCP_PROJECTS="common-build,kc-core-dev,kc-core-prod,platform-dev-788014,platform-prod-399563,strong-keyword-184513"

# [okonfig] generate kubectl config from GCP projects
okonfig() { gcpkonfig "$ORM_GCP_PROJECTS"; }

# [ogpl] list a subset of ORM GCP projects
ogpl() { gpf "$ORM_GCP_PROJECTS"; }

# [otags] list container image tags
otags() { gtags common-build "$1"; }

# [ois] creates python environment for infractl
alias ois='orm-infractl-setup'
orm-infractl-setup() {
    [[ -f ./install.sh ]] || return 1
    rm .env
    bash install.sh env
    bash install.sh
    source ./ve/bin/activate
    bash install.sh deploy-local
}

# [okclean] remove contexts added by infractl
okclean() {
    local context current_context; current_context=$(kubectl config current-context)
    krename; kubectl config unset current-context &> /dev/null
    for context in $(kubectl config get-contexts | awk '(NR>1) {print $1}' | grep -E '^gke'); do
        kubectl config delete-context "$context"
    done
    kubectl config set current-context "$(grep -o '[^_]*$' <<< "$current_context")" &> /dev/null
}

# [_ogp] interactive gcloud project select
alias -g _ogp='--project $(echo -e ${ORM_GCP_PROJECTS//,/\\n} | fzf --no-multi --ansi -i -1 --height=50% --reverse -0 --inline-info --border rounded)'

# [_okc] interactive kubectl context select
alias -g _okc='_kc'

# [gc-] gcloud aliases
alias gc-bhdev='gcloud --project binderhub-dev'
alias gc-bhprod='gcloud --project binderhub-prod'
alias gc-commonbuild='gcloud --project common-build'
alias gc-dataengdev='gcloud --project dataeng-dev-273349'
alias gc-dataeng-prod='gcloud --project dataeng-prod-308999'
alias gc-kcdev='gcloud --project kc-core-dev'
alias gc-kcprod='gcloud --project kc-core-prod'
alias gc-platdatadev='gcloud --project platform-data-dev-301120'
alias gc-platformdev='gcloud --project platform-dev-788014'
alias gc-platformprod='gcloud --project platform-prod-399563'
alias gc-playground='gcloud --project strong-keyword-184513'

# [ohelp] show this help message
ohelp() {
    echo "helper aliases and functions for ORM"
    echo
    grep -E '^# \[.+\]' "${(%):-%x}"
}
