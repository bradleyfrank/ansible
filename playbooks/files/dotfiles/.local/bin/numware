#!/usr/bin/env bash

#
# Creates a dicware passphrase with an equal-length random number at the end.
# Author: Brad Frank
# Date: Nov 2020
# Tested: GNU bash, version 5.0.18(1)-release (x86_64-apple-darwin19.6.0)
# Requires: keepassxc-cli
#


# ----- functions ----- #

function generate() {
    local length dice word capital diceware=""
    length="$1"

    readarray -d " " -t dice < <( keepassxc-cli diceware --words "$length" )

    for word in "${dice[@]}"; do
        capital="$(printf "%s" "${word:0:1}" | tr '[:lower:]' '[:upper:]')"
        word="${word%$'\n'}" # remove newline
        diceware="${capital}${word:1}-${diceware}"
    done

    printf "%s%s\n" "$diceware" "$(keepassxc-cli generate -L "$length" -n)"
}


# ----- begin ----- #

length=5

while getopts ':hn:' flag; do
  case "$flag" in
    h) echo "Usage: numware [ -n <length> ]" ; return 0 ;;
    n) length=$OPTARG ;;
    *) echo "Invalid argument." >&2 ; return 1 ;;
  esac
done

[[ "$length" -lt 2 ]] && { echo "Length must be a value greater than 1."; exit 1; }
generate "$length"
