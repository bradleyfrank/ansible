#!/usr/bin/env bash

#
# Displays various information for tmux status bar
# Author: Brad Frank
# Date: July 2021
# Tested: GNU bash, version 5.1.8(1)-release (x86_64-apple-darwin20.3.0)
#

SYSINFO=""
BATT=""

fg_Base00="#[fg=colour241]"
fg_Green="#[fg=colour64]"
fg_Magenta="#[fg=colour125]"
fg_Orange="#[fg=colour166]"
fg_Red="#[fg=colour160]"

macos() {
  SYSINFO="$(sw_vers | awk '{print $2}' | xargs echo)"
  BATT="$(pmset -g batt | grep 'InternalBattery' | cut -f2 | awk -F\; '{print $1$2}')"
}

linux() {
  SYSINFO="$(lsb_release -sd)"
  if [[ -d /sys/class/power_supply/BAT0 ]]; then
    BATT="$(cat /sys/class/power_supply/BAT0/capacity)% $(cat /sys/class/power_supply/BAT0/status)"
  else
    BATT="a/c power"
  fi
}

case $1 in
  Darwin) macos ;;
  Linux ) linux ;;
esac

if [[ -n $SSH_CONNECTION ]]; then
  SYSTEMNAME="${fg_Red}[$(hostname -s)]"
else
  SYSTEMNAME="${fg_Green}[$(hostname -s)]"
fi

SYSINFO="${fg_Magenta}[${SYSINFO}]"
BATT="${fg_Orange}[${BATT}]"
DATE="${fg_Base00}[$(date +'%a %b %d %I:%M')]"

printf "%s %s %s %s" "$SYSTEMNAME" "$SYSINFO" "$BATT" "$DATE"
