---

- name: "Create secrets file"
  hosts: localhost

  vars:
    ed25519_passphrase: "{{
      lookup('community.general.random_words', numwords=5, delimiter='-', case='capitalize')
    }}"
    rsa_passphrase: "{{
      lookup('community.general.random_words', numwords=5, delimiter='-', case='capitalize')
    }}"
    vault_passphrase: "{{
      lookup('community.general.random_words', numwords=5, delimiter='-', case='capitalize')
    }}"

  tasks:
    - name: "Create vault file"
      ansible.builtin.copy:
        content: "{{ vault_passphrase }}"
        #dest: "{{ ansible_facts['user_dir'] }}/.ansible/vault"
        dest: "vault"
        mode: "0400"

    - debug: msg="{{ vault_passphrase }}"

    - name: "Create secrets file"
      vars:
        ed25519_encrypted: "{{ ed25519_passphrase | ansible.builtin.vault(vault_passphrase) }}"
        rsa_encrypted: "{{ rsa_passphrase | ansible.builtin.vault(vault_passphrase) }}"
        github_token_encrypted: "{{ git_github_token | ansible.builtin.vault(vault_passphrase) }}"
      ansible.builtin.template:
        src: "secrets.yml.j2"
        dest: "secrets.yml"
        decrypt: false
        mode: "0600"
